<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<dom-module id="reminder-item">

<template>
	<style>
		div {
			max-width: 80%;
			color: grey;
		}
      .card {
        box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12), 0 3px 1px -2px rgba(0, 0, 0, 0.2);
        padding: 16px;
        margin: 24px;
        border-radius: 5px;
        background-color: #fff;
        color: #757575;
      }

	</style>
	<div class="card">
		<h2> Reminder </h2>
		<!-- reminder data -->
		<firebase-document path="/reminders/" data="{{reminder}}"></firebase-document>
		<reminder-data label="{{label}}" toCallName="{{toCallName}}" toCallNum="{{toCallNum}}" isEditable="{{isEditable}}">
		</reminder-data>

		<paper-input id="titleInput" name="title" disabled value="{{reminder.label}}">
			<div prefix> Message&nbsp;</div>
		</paper-input>
		<paper-input id="nameInput" name="toCallName" disabled value="{{reminder.toCallName}}">
			<div prefix> Call&nbsp;</div>
		</paper-input>
		<paper-input id="numInput" name="toCallNum" disabled value="{{reminder.toCallNum}}">
			<div prefix> At&nbsp;</div>
		</paper-input>
		<paper-button on-tap="makeEditable" id="isEditable" name="isEditable" value="{{reminder.isEditable}}" link> EDIT </paper-button>
		<paper-button on-tap="remove" link> REMOVE </paper-button>
	</div>
</template>

<script>
Polymer({
	is: 'reminder-item',
	properties: {
		reminder: Object,
		path: '/reminders'
	},
	remove: function() {
		var reminderRef = firebase.app('call-your-grandma').database().ref("/reminders/" + this.reminder.$key).remove();
	},
	makeEditable: function () {
		this.path = '/reminders/'
		if (this.reminder.isEditable) {
			this.reminder.isEditable = false;
			var inputs = this.root.childNodes[2].getElementsByTagName("paper-input")
			for (i = 0; i < inputs.length; i++) {
			    inputs[i].disabled = true;
			}
	
	        if (this.reminder.$key == null)	{
	        	this.path = '/reminders/';
		        var reminderRef = firebase.app('call-your-grandma').database().ref(this.path).push(this.reminder);
		        var key = reminderRef.key;
	        } else {
			var reminderRef = firebase.app('call-your-grandma').database()
										.ref(this.path + this.reminder.$key)
										.update({
											label: this.reminder.label,
								            isActive: this.reminder.isActive,
								            isEditable: this.reminder.isEditable,
								            toCallName: this.reminder.toCallName,
								            toCallNum: this.reminder.toCallNum
										});
	        }		

		
			this.root.childNodes[2].getElementsByTagName("paper-button")[0].innerHTML = "EDIT";
			console.log();
		} 
		else {
			this.reminder.isEditable = true;
			var inputs = this.root.childNodes[2].getElementsByTagName("paper-input")
			for (i = 0; i < inputs.length; i++) {
			    inputs[i].disabled = false;
			}
			var reminderRef = firebase.app('call-your-grandma').database()
										.ref(this.path + this.reminder.$key)
										.update({
											label: this.reminder.label,
								            isActive: this.reminder.isActive,
								            isEditable: this.reminder.isEditable,
								            toCallName: this.reminder.toCallName,
								            toCallNum: this.reminder.toCallNum
										});
			this.root.childNodes[2].getElementsByTagName("paper-button")[0].innerHTML = "SAVE";
		}
	},
	notify: true

});
</script>

</dom-module>